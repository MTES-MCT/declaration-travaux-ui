(this["webpackJsonprieau-ui"]=this["webpackJsonprieau-ui"]||[]).push([[7],{609:function(e,n,t){"use strict";t.r(n);var i=[{id:"jean.martin",email:"jean.martin@monfai.fr",prenom:"Jean",nom:"Martin",profils:["DEPOSANT","BETA"]},{id:"jacques.dupont",email:"jacques.dupont@monfai.fr",prenom:"Jacques",nom:"Dupont",profils:["INSTRUCTEUR"]},{id:"madame.le-maire",email:"madame.le-maire@monfai.fr",prenom:"Madame",nom:"Le Maire",profils:["MAIRIE","BETA"],codePostal:"44100"}],r=[{id:"DEPOSE",ordre:0,libelle:"d\xe9pos\xe9",delai:7},{id:"QUALIFIE",ordre:1,libelle:"qualifi\xe9",delai:30},{id:"INCOMPLET",ordre:2,libelle:"incomplet",delai:7},{id:"COMPLET",ordre:3,libelle:"complet",delai:7},{id:"DECISION",ordre:5,libelle:"d\xe9cid\xe9",delai:7}],u=null,o=100;var s=[];function c(){return new Date}function f(e,n){e.statutActuel=r.find((function(e){return e.id===n})),e.statutActuel.dateDebut=c(),e.statutActuel.joursRestants=e.statutActuel.delai,e.statuts.push(e.statutActuel),e.statutsRestants=r.filter((function(n){return n.ordre>e.statutActuel.ordre&&"INCOMPLET"!==n.id}))}function a(e,n){e.messages.push({date:c(),contenu:n,auteur:u}),e.messages.sort((function(e,n){return-(e.date-n.date)}))}function d(e){var n="";return e&&e.length>0&&(e.toUpperCase().includes("13406_PCMI")&&(n={id:"PCMI",libelle:"Permis de construire de maison individuelle"}),e.toUpperCase().includes("13703_DPMI")&&(n={id:"DPMI",libelle:"D\xe9claration pr\xe9alable"})),n}function l(e){var n=[];return"PCMI"===e.id&&(n=["1","2","3","4","5","6","7","8"]),"DPMI"===e.id&&(n=["1"]),n}function m(e){return"Fichier CERFA ".concat(e.name," non reconnu. Seuls les fichiers nomm\xe9s cerfa_13406_PCMI.pdf ou cerfa_13703_DPMI.pdf sont reconnus.")}function p(e,n,t){var i=new FileReader;i.onload=function(){var r=i.result;sessionStorage.setItem(e.type.id+n,JSON.stringify({nom:t.name,type:t.type,size:t.size,data:URL.createObjectURL(new Blob([r],{type:t.type}))}))},i.readAsBinaryString(t)}var P={auth:{login:function(e){return new Promise((function(n,t){setTimeout((function(){return e?n(u=i.find((function(n){return n.id===e}))):t(new Error("Connexion impossible. User id inconnu."))}),o)}))},isAuthenticated:function(){return new Promise((function(e,n){setTimeout((function(){return e(null!==u)}),o)}))},logout:function(){return new Promise((function(e,n){setTimeout((function(){e(u=null)}),o)}))},getUser:function(){return new Promise((function(e,n){setTimeout((function(){return u?e(u):n(new Error("Pas d'utilisateur connect\xe9"))}),o)}))},isDeposant:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("DEPOSANT"))}),o)}))},isMairie:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("MAIRIE"))}),o)}))},isInstructeur:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("INSTRUCTEUR"))}),o)}))},isBeta:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("BETA"))}),o)}))}},dossiers:{listerDossiers:function(){return new Promise((function(e,n){setTimeout((function(){return e(s)}),(function(e){return n(e)}),o)}))},consulterDossier:function(e){return new Promise((function(n,t){setTimeout((function(){return n(s.find((function(n){return n.id===e})))}),o)}))},ajouterDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var i=e.get("file"),o=d(i.name);if(""===o)return t(new Error(m(i)));var c={type:o,numero:"0",fichierId:o.id+"0",dossierId:s.length.toString()},a={id:s.length.toString(),type:o,userId:u.id,cerfa:c,piecesAJoindre:l(o),piecesJointes:[],statuts:[],statutsRestants:r,messages:[]};return f(a,"DEPOSE"),p(a,"0",i),s.push(a),n()}),o)}))},savePieceJointe:function(e,n,t){return new Promise((function(i,r){setTimeout((function(){var r=t.get("file");if(!function(e,n){if(!n.name)return!0;var t=d(n.name),i=!0;return e.includes("cerfa")&&(i=e===t.id+"0"),e.includes(t)&&(i=e===t.id+"d"),i}(n,r))throw new Error(m(r));var u=s.find((function(n){return n.id===e}));return p(u,n,r),u.piecesJointes.push({type:u.type,numero:n,fichierId:u.type.id+n,DossierId:e}),i()}),o)}))},saveMessage:function(e,n){return new Promise((function(t,i){setTimeout((function(){return a(s.find((function(n){return n.id===e})),n),t()}),o)}))},lireFichier:function(e){return new Promise((function(n,t){setTimeout((function(){return n(JSON.parse(sessionStorage.getItem(e)))}),o)}))},qualifierDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"QUALIFIE"),n(t)}),o)}))},declarerIncompletDossier:function(e,n){return new Promise((function(t,i){setTimeout((function(){var i=s.find((function(n){return n.id===e}));return f(i,"INCOMPLET"),a(i,n),t(i)}),o)}))},declarerCompletDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"COMPLET"),n(t)}),o)}))},prendreDecision:function(e,n){return new Promise((function(t,i){setTimeout((function(){var i=n.get("file"),r=s.find((function(n){return n.id===e}));f(r,"DECISION");var u={type:r.type,numero:"d",fichierId:r.type.id+"d",dossierId:s.length.toString()};return r.decision=u,p(r,"d",i),t(r)}),o)}))},supprimerDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e})),i=s.indexOf(t);for(var r in s.splice(i,1),sessionStorage.removeItem(t.type.id+"0"),t.piecesJointes)sessionStorage.removeItem(r.fichierId);return n()}),o)}))}}};n.default=P}}]);
//# sourceMappingURL=7.1c5b56a5.chunk.js.map