(this["webpackJsonprieau-ui"]=this["webpackJsonprieau-ui"]||[]).push([[6],{610:function(n,r,e){"use strict";e.r(r);var t=e(97),o=e(98),c=e(101),s=e(99),i=e(100),u=e(702),a=e.n(u),f=e(719),d=function(n){function r(){return Object(t.a)(this,r),Object(c.a)(this,Object(s.a)(r).apply(this,arguments))}return Object(i.a)(r,n),Object(o.a)(r,[{key:"createAxiosInstance",value:function(n){var r=this,e=a.a.create(n);return e.interceptors.request.use((function(n){return new Promise((function(e,t){return r.updateToken(5).success((function(){n.headers.Authorization="Bearer "+r.token,e(n)})).error((function(){r.login()}))}))})),e.interceptors.response.use((function(n){return n}),(function(n){return n.response?n.response.data.cause?Promise.reject(n.response.data.cause):Promise.reject(n.response.data):n.request?Promise.reject(n.request):Promise.reject(n)})),e}}],[{key:"axios",get:function(){return a.a}}]),r}(e.n(f).a),p=e(130),l=new d({url:Object(p.a)("REACT_APP_SSO_APP_URL"),realm:Object(p.a)("REACT_APP_SSO_APP_REALM"),clientId:Object(p.a)("REACT_APP_SSO_APP_CLIENT_ID")}),h=l.createAxiosInstance({baseURL:Object(p.a)("REACT_APP_API_URL"),responseType:"json",responseEncoding:"utf8",headers:{"Content-Type":"application/json;charset=UTF-8"},withCredentials:!0}),m=["DEPOSANT","BETA","INSTRUCTEUR","MAIRIE"];function w(n){var r=[];return m.forEach((function(e){return function(n,r,e){n.hasRealmRole(e)&&r.push(e)}(n,r,e)})),r}var P={auth:{login:function(){return new Promise((function(n,r){return l.init({onLoad:"login-required"}).success((function(r){return n(r)})).error((function(n){return r(new Error(n))}))}))},isAuthenticated:function(){return new Promise((function(n,r){return l.init({onLoad:"check-sso"}).success((function(r){return n(r)})).error((function(n){return r(new Error(n))}))}))},logout:function(){return new Promise((function(n,r){return l.logout().success((function(r){return n(r)})).error((function(n){return r(new Error(n))}))}))},getUser:function(){return new Promise((function(n,r){return l.loadUserInfo().success((function(r){return n({prenom:r.given_name,nom:r.family_name,profils:w(l),email:r.email})})).error((function(n){return r(new Error(n))}))}))},isDeposant:function(){return new Promise((function(n,r){return n(l.hasRealmRole("DEPOSANT"))}))},isMairie:function(){return new Promise((function(n,r){return n(l.hasRealmRole("MAIRIE"))}))},isInstructeur:function(){return new Promise((function(n,r){return n(l.hasRealmRole("INSTRUCTEUR"))}))},isBeta:function(){return new Promise((function(n,r){return n(l.hasRealmRole("BETA"))}))}},dossiers:{listerDossiers:function(){return new Promise((function(n,r){return l.init({onLoad:"check-sso"}).success((function(r){return n(h.get("/dossiers").then((function(n){return n.data})))})).error((function(n){return r(new Error(n))}))}))},consulterDossier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(e){return r(h.get("/dossiers/".concat(n)).then((function(n){return n.data})))})).error((function(n){return e(new Error(n))}))}))},ajouterDossier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(t){h.post("/dossiers",n,{headers:{"content-type":"multipart/form-data;boundary=gc0p4Jq0M2Yt08jU534c0p"}}).then((function(n){return r(n)})).catch((function(n){return console.log("error=",JSON.stringify(n)),e(n)}))})).error((function(n){return e(new Error(n))}))}))},supprimerDossier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(e){return r(h.delete("/dossiers/".concat(n)).then((function(n){return n.data})))})).error((function(n){return e(new Error(n))}))}))},savePieceJointe:function(n,r,e){return new Promise((function(t,o){return l.init({onLoad:"check-sso"}).success((function(c){return t(h.post("/dossiers/".concat(n,"/piecesjointes/").concat(r),e,{headers:{"content-type":"multipart/form-data;boundary=gc0p4Jq0M2Yt08jU534c0p"}}).catch((function(n){return console.log("error=",JSON.stringify(n)),o(n)})))})).error((function(n){return o(new Error(n))}))}))},saveMessage:function(n,r){return new Promise((function(e,t){return l.init({onLoad:"check-sso"}).success((function(o){return e(h.post("/dossiers/".concat(n,"/messages"),r).catch((function(n){return console.log("error=",JSON.stringify(n)),t(n)})))})).error((function(n){return t(new Error(n))}))}))},lireFichier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(t){return r(h.get("/fichiers/".concat(n),{responseType:"blob"}).then((function(n){return function(n){var r=n.headers["content-disposition"],e=n.headers["content-type"],t=/^attachment;filename=([\w- \xe9\xe8\xeb\xe0\xf9\u20ac\xea\xf4\xef\xee]+[.]{1}[\w]+)$/i.exec(r);return{data:URL.createObjectURL(new Blob([n.data],{type:e})),nom:t[1],type:e}}(n)})).catch((function(n){return console.log("error=",JSON.stringify(n)),e(n)})))})).error((function(n){return e(new Error(n))}))}))},qualifierDossier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(e){return r(h.post("/dossiers/".concat(n,"/qualifier")).then((function(n){return n.data})))})).error((function(n){return e(new Error(n))}))}))},declarerIncompletDossier:function(n,r){return new Promise((function(e,t){return l.init({onLoad:"check-sso"}).success((function(t){return e(h.post("/dossiers/".concat(n,"/declarer-incomplet"),r).then((function(n){return n.data})))})).error((function(n){return t(new Error(n))}))}))},declarerCompletDossier:function(n){return new Promise((function(r,e){return l.init({onLoad:"check-sso"}).success((function(e){return r(h.post("/dossiers/".concat(n,"/declarer-complet")).then((function(n){return n.data})))})).error((function(n){return e(new Error(n))}))}))},prendreDecision:function(n,r){return new Promise((function(e,t){return l.init({onLoad:"check-sso"}).success((function(o){h.post("/dossiers/".concat(n,"/prendre-decision"),r,{headers:{"content-type":"multipart/form-data;boundary=gc0p4Jq0M2Yt08jU534c0p"}}).then((function(n){return e(n)})).catch((function(n){return console.log("error=",JSON.stringify(n)),t(n)}))})).error((function(n){return t(new Error(n))}))}))}}};r.default=P}}]);
//# sourceMappingURL=6.d7914d77.chunk.js.map