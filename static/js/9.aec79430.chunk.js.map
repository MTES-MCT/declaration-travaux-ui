{"version":3,"sources":["utils/api-real.js"],"names":["__webpack_require__","r","__webpack_exports__","axios__WEBPACK_IMPORTED_MODULE_0__","axios__WEBPACK_IMPORTED_MODULE_0___default","n","keycloak_js__WEBPACK_IMPORTED_MODULE_1__","keycloak_js__WEBPACK_IMPORTED_MODULE_1___default","apiHttpClient","axios","create","baseURL","process","timeout","keycloak","Keycloak","url","realm","clientId","interceptors","request","use","config","token","headers","Authorization","concat","error","Promise","reject","api","auth","login","resolve","init","onLoad","success","authenticated","message","JSON","stringify","isAuthenticated","logout","getUser","loadUserInfo","userInfo","firstName","given_name","lastName","family_name","email","isDepositaire","hasRealmRole","isInstructeur","depots","mesDepots","get","savePieceJointe","code","file","binary","post"],"mappings":"0FAAAA,EAAAC,EAAAC,GAAA,IAAAC,EAAAH,EAAA,KAAAI,EAAAJ,EAAAK,EAAAF,GAAAG,EAAAN,EAAA,KAAAO,EAAAP,EAAAK,EAAAC,GAKME,EAAgBC,IAAMC,OAAO,CACjCC,QAASC,wBACTC,QAAS,MAGLC,EAAWC,IAAS,CACxBC,IAAKJ,6BACLK,MAAOL,QACPM,SAAUN,aAGZH,IAAMU,aAAaC,QAAQC,IACzB,SAASC,GACP,IAAMC,EAAQT,EAASS,MAEvB,OADIA,IAAOD,EAAOE,QAAQC,cAAf,UAAAC,OAAyCH,IAC7CD,GAET,SAASK,GACP,OAAOC,QAAQC,OAAOF,KAgF1B,IAaMG,EAAM,CACVC,KAdW,CACXC,MA7EF,WACE,OAAO,IAAIJ,QAAQ,SAACK,EAASJ,GAC3B,OAAOf,EACJoB,KAAK,CAAEC,OAAQ,mBACfC,QAAQ,SAAAC,GACP,OAAOJ,EAAQI,KAEhBV,MAAM,SAAAA,GACL,OAAOE,EAAO,CAAES,QAASC,KAAKC,UAAUb,UAsE9Cc,gBApDF,WACE,OAAO,IAAIb,QAAQ,SAACK,EAASJ,GAC3B,OAAOf,EACJoB,KAAK,CAAEC,OAAQ,cACfC,QAAQ,SAAAC,GACP,OAAOJ,EAAQI,KAEhBV,MAAM,SAAAA,GACL,OAAOE,EAAO,CAAES,QAASC,KAAKC,UAAUb,UA6C9Ce,OAlEF,WACE,OAAO,IAAId,QAAQ,SAACK,EAASJ,GAC3B,OAAOf,EACJ4B,SACAN,QAAQ,SAAAC,GACP,OAAOJ,EAAQI,KAEhBV,MAAM,SAAAA,GACL,OAAOE,EAAO,CAAES,QAASC,KAAKC,UAAUb,UA2D9CgB,QA7BF,WACE,OAAO,IAAIf,QAAQ,SAACK,EAASJ,GAC3B,OAAOf,EACJ8B,eACAR,QAAQ,SAAAS,GACP,OAAOZ,EAAQ,CACba,UAAWD,EAASE,WACpBC,SAAUH,EAASI,YACnBC,MAAOL,EAASK,UAGnBvB,MAAM,SAAAA,GACL,OAAOE,EAAO,CAAES,QAASC,KAAKC,UAAUb,UAkB9CwB,cA1CF,WACE,OAAO,IAAIvB,QAAQ,SAACK,EAASJ,GAC3B,OAAOI,EAAQnB,EAASsC,aAAa,mBAyCvCC,cArCF,WACE,OAAO,IAAIzB,QAAQ,SAACK,EAASJ,GAC3B,OAAOI,EAAQnB,EAASsC,aAAa,oBA4CvCE,OAPa,CACbC,UAjBF,WACE,OAAO/C,EAAcgD,IAAd,YAiBPC,gBAdF,SAAyBC,EAAMC,EAAMC,GACnC,OAAOpD,EAAcqD,KAAd,iBAAqC,CAAEH,OAAMC,OAAMC,cAqB7C9B","file":"static/js/9.aec79430.chunk.js","sourcesContent":["import axios from 'axios';\nimport Keycloak from 'keycloak-js';\n\n// API rÃ©elle\n\nconst apiHttpClient = axios.create({\n  baseURL: process.env.REACT_APP_API_URL,\n  timeout: 1000\n});\n\nconst keycloak = Keycloak({\n  url: process.env.REACT_APP_SSO_APP_URL,\n  realm: process.env.REACT_APP_SSO_APP_REALM,\n  clientId: process.env.REACT_APP_SSO_APP_CLIENT_ID\n});\n\naxios.interceptors.request.use(\n  function(config) {\n    const token = keycloak.token;\n    if (token) config.headers.Authorization = `Bearer ${token}`;\n    return config;\n  },\n  function(error) {\n    return Promise.reject(error);\n  }\n);\n\nfunction login() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'login-required' })\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject({ message: JSON.stringify(error) });\n      });\n  });\n}\n\nfunction logout() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .logout()\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject({ message: JSON.stringify(error) });\n      });\n  });\n}\n\nfunction isAuthenticated() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .init({ onLoad: 'check-sso' })\n      .success(authenticated => {\n        return resolve(authenticated);\n      })\n      .error(error => {\n        return reject({ message: JSON.stringify(error) });\n      });\n  });\n}\n\nfunction isDepositaire() {\n  return new Promise((resolve, reject) => {\n    return resolve(keycloak.hasRealmRole('depositaire'));\n  });\n}\n\nfunction isInstructeur() {\n  return new Promise((resolve, reject) => {\n    return resolve(keycloak.hasRealmRole('instructeur'));\n  });\n}\n\nfunction getUser() {\n  return new Promise((resolve, reject) => {\n    return keycloak\n      .loadUserInfo()\n      .success(userInfo => {\n        return resolve({\n          firstName: userInfo.given_name,\n          lastName: userInfo.family_name,\n          email: userInfo.email\n        });\n      })\n      .error(error => {\n        return reject({ message: JSON.stringify(error) });\n      });\n  });\n}\n\nfunction mesDepots() {\n  return apiHttpClient.get(`/depots`);\n}\n\nfunction savePieceJointe(code, file, binary) {\n  return apiHttpClient.post(`/piecesjointes`, { code, file, binary });\n}\n\nconst auth = {\n  login,\n  isAuthenticated,\n  logout,\n  getUser,\n  isDepositaire,\n  isInstructeur\n};\nconst depots = {\n  mesDepots,\n  savePieceJointe\n};\n\nconst api = {\n  auth,\n  depots\n};\n\nexport default api;\n"],"sourceRoot":""}