(this["webpackJsonprieau-ui"]=this["webpackJsonprieau-ui"]||[]).push([[8],{606:function(e,n,t){"use strict";t.r(n);var i=[{id:"jean.martin",email:"jean.martin@monfai.fr",firstName:"Jean",lastName:"Martin",profils:["DEPOSANT","BETA"]},{id:"jacques.dupont",email:"jacques.dupont@monfai.fr",firstName:"Jacques",lastName:"Dupont",profils:["INSTRUCTEUR"]},{id:"madame.le-maire",email:"madame.le-maire@monfai.fr",firstName:"Madame",lastName:"Le Maire",profils:["MAIRIE","BETA"],codePostal:["44100"]}],r=[{id:"DEPOSE",ordre:0,libelle:"d\xe9pos\xe9"},{id:"QUALIFIE",ordre:1,libelle:"qualifi\xe9"},{id:"INCOMPLET",ordre:2,libelle:"d\xe9clar\xe9 incomplet"},{id:"INSTRUCTION",ordre:2,libelle:"instruit"},{id:"COMPLET",ordre:3,libelle:"d\xe9clar\xe9 complet"},{id:"CONSULTATIONS",ordre:4,libelle:"consult\xe9"},{id:"DECISION",ordre:5,libelle:"d\xe9cision prise"}],u=null,o=100;var s=[];function c(){return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}).format(new Date)}function f(e,n){e.statutActuel=r.find((function(e){return e.id===n})),e.statutActuel.dateDebut=c(),e.statuts.push(e.statutActuel),e.statutsRestants=r.filter((function(n){return n.ordre>e.statutActuel.ordre}))}function a(e){var n="";return e&&e.length>0&&(e.toUpperCase().includes("13406_PCMI")&&(n={id:"PCMI",libelle:"Permis de construire de maison individuelle"}),e.toUpperCase().includes("13703_DPMI")&&(n={id:"DPMI",libelle:"D\xe9claration pr\xe9alable"})),n}function d(e){var n=[];return"PCMI"===e.id&&(n=["1","2","3","4","5","6","7","8"]),"DPMI"===e.id&&(n=["1"]),n}function l(e){return"Fichier CERFA ".concat(e.name," non reconnu. Seuls les fichiers nomm\xe9s cerfa_13406_PCMI.pdf ou cerfa_13703_DPMI.pdf sont reconnus.")}function m(e,n,t){var i=new FileReader;i.onload=function(){var r=i.result;sessionStorage.setItem(e.type.id+n,JSON.stringify({nom:t.name,type:t.type,size:t.size,data:URL.createObjectURL(new Blob([r],{type:t.type}))}))},i.readAsBinaryString(t)}var p={auth:{login:function(e){return new Promise((function(n,t){setTimeout((function(){return e?n(u=i.find((function(n){return n.id===e}))):t(new Error("Connexion impossible. User id inconnu."))}),o)}))},isAuthenticated:function(){return new Promise((function(e,n){setTimeout((function(){return e(null!==u)}),o)}))},logout:function(){return new Promise((function(e,n){setTimeout((function(){e(u=null)}),o)}))},getUser:function(){return new Promise((function(e,n){setTimeout((function(){return u?e(u):n(new Error("Pas d'utilisateur connect\xe9"))}),o)}))},isDeposant:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("DEPOSANT"))}),o)}))},isMairie:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("MAIRIE"))}),o)}))},isInstructeur:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("INSTRUCTEUR"))}),o)}))},isBeta:function(){return new Promise((function(e,n){setTimeout((function(){return e(u.profils.includes("BETA"))}),o)}))}},dossiers:{listerDossiers:function(){return new Promise((function(e,n){setTimeout((function(){return e(s)}),(function(e){return n(e)}),o)}))},consulterDossier:function(e){return new Promise((function(n,t){setTimeout((function(){return n(s.find((function(n){return n.id===e})))}),o)}))},ajouterDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var i=e.get("file"),o=a(i.name);if(""===o)return t(new Error(l(i)));var c={id:s.length.toString(),type:o,userId:u.id,cerfa:{type:o,numero:"0",fichierId:o.id+"0",dossierId:s.length.toString()},piecesAJoindre:d(o),piecesJointes:[],statuts:[],statutsRestants:r,messages:[]};return f(c,"DEPOSE"),m(c,"0",i),s.push(c),n()}),o)}))},savePieceJointe:function(e,n,t){return new Promise((function(i,r){setTimeout((function(){var r=t.get("file");if(!function(e,n){if(!n.name)return!0;var t=a(n.name);return!e.includes("cerfa")||e===t.id+"0"}(n,r))throw new Error(l(r));var u=s.find((function(n){return n.id===e}));return m(u,n,r),u.piecesJointes.push({type:u.type,numero:n,fichierId:u.type.id+n,DossierId:e}),i()}),o)}))},saveMessage:function(e,n){return new Promise((function(t,i){setTimeout((function(){return s.find((function(n){return n.id===e})).messages.push({date:c(),contenu:n,auteur:u}),t()}),o)}))},lireFichier:function(e){return new Promise((function(n,t){setTimeout((function(){return n(JSON.parse(sessionStorage.getItem(e)))}),o)}))},qualifierDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"QUALIFIE"),n(t)}),o)}))},instruireDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"INSTRUCTION"),n(t)}),o)}))},declarerIncompletDossier:function(e,n){return new Promise((function(t,i){setTimeout((function(){var i=s.find((function(n){return n.id===e}));return f(i,"INCOMPLET"),i.messages=[{contenu:n,auteur:u,date:c()}],t(i)}),o)}))},declarerCompletDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"COMPLET"),n(t)}),o)}))},lancerConsultations:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e}));return f(t,"CONSULTATIONS"),n(t)}),o)}))},prendreDecision:function(e,n){return f(s.find((function(n){return n.id===e})),"DECISION"),this.savePieceJointe(e,"d",n)},supprimerDossier:function(e){return new Promise((function(n,t){setTimeout((function(){var t=s.find((function(n){return n.id===e})),i=s.indexOf(t);for(var r in s.splice(i,1),sessionStorage.removeItem(t.type.id+"0"),t.piecesJointes)sessionStorage.removeItem(r.fichierId);return n()}),o)}))}}};n.default=p}}]);
//# sourceMappingURL=8.1aec7314.chunk.js.map